test-client:
    stage: test
    image: gcc
    before_script:
        - >
            apt-get update -yqq &&
            apt-get install -yqq
            cmake clang qt6-base-dev clang-tidy clang-format
        - update-alternatives --set c++ /usr/bin/clang++
        - cd client
    script:
        - make
        - make lint
        - make test
    rules:
        - changes:
            - .gitlab-ci.yml
            - client/**/*

test-server:
    stage: test
    image: python:3.10
    before_script:
        - pip install --upgrade pip
        - cd server
        - pip install -r requirements.txt
    script:
        ./lint.py
        ./manage.py migrate
        ./manage.py test
    rules:
        - changes:
            - .gitlab-ci.yml
            - server/**/*
